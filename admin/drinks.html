<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Main Course</title>
    <link rel="icon" type="image/x-icon" href="../img/logo/logo-alt.png" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <style>
      /* Original styles remain unchanged */
      body {
        font-family: "Poppins", sans-serif;
        background-color: #f8f9fa;
      }
      .sidebar {
        height: 100vh;
        position: fixed;
        background-color: #343a40;
        color: white;
        width: 250px;
        transition: width 0.3s;
        z-index: 1000;
      }
      .sidebar.collapsed {
        width: 80px;
      }
      .sidebar .menu-item {
        display: flex;
        align-items: center;
        padding: 12px 15px;
        cursor: pointer;
        transition: background-color 0.3s;
      }
      .sidebar .menu-item:hover {
        background-color: #484e53;
      }
      .sidebar.collapsed .menu-item span {
        display: none;
      }
      .sidebar .menu-item a {
        color: white;
        text-decoration: none;
      }
      .sidebar .menu-item i {
        font-size: 1.5rem;
        min-width: 40px;
      }
      .content {
        margin-left: 250px;
        padding: 20px;
        transition: margin-left 0.3s;
      }
      .content.collapsed {
        margin-left: 80px;
      }
      .logo-container {
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 1rem;
        transition: all 0.3s;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      }
      .logo-container img {
        width: 50px;
        height: 50px;
      }
      .logo-container span {
        margin-left: 10px;
        transition: opacity 0.3s;
        font-weight: bold;
        font-size: 1.2rem;
      }
      .sidebar.collapsed .logo-container span {
        display: none;
      }
      .active-menu-item {
        background-color: #484e53;
        border-left: 4px solid #0d6efd;
      }

      /* New styles for main content table */
      .main-content {
        background: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        margin-top: 20px;
      }

      .table-controls {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
      }

      .table-container {
        overflow-x: auto;
      }

      .table {
        border: 1px solid #dee2e6;
        margin-bottom: 0;
      }

      .table th {
        background-color: #f8f9fa;
        cursor: pointer;
        position: relative;
        padding-right: 25px;
        white-space: nowrap;
      }

      .table th::after {
        content: "↕";
        position: absolute;
        right: 8px;
        opacity: 0.5;
      }

      .table th.asc::after {
        content: "↑";
        opacity: 1;
      }

      .table th.desc::after {
        content: "↓";
        opacity: 1;
      }

      .table td {
        vertical-align: middle;
      }

      .table tbody tr:hover {
        background-color: rgba(0, 0, 0, 0.02);
      }

      .menu-image {
        width: 60px;
        height: 60px;
        object-fit: cover;
        border-radius: 4px;
      }

      .action-buttons {
        white-space: nowrap;
      }

      .action-buttons button {
        padding: 0.25rem 0.5rem;
        margin: 0 0.25rem;
      }

      .table td,
      .table th {
        border: 1px solid #dee2e6;
      }

      .pagination-info {
        margin-top: 1rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .modal-body {
        max-height: 70vh;
        overflow-y: auto;
      }

      #imagePreview {
        max-width: 200px;
        max-height: 200px;
        margin-top: 10px;
      }

      #imagePreview img {
        width: 100%;
        height: auto;
        border-radius: 4px;
      }
    </style>
  </head>
  <body>
    <!-- Original Sidebar -->
    <div id="sidebar" class="sidebar">
      <div class="logo-container">
        <img src="../img/logo/logo-alt.png" alt="Logo" />
        <span>BOLOOO</span>
      </div>
      <div class="menu-item">
        <a href="dashboard.html"
          ><i class="bi bi-house-door me-2"></i> <span>Dashboard</span></a
        >
      </div>
      <div class="menu-item active-menu-item">
        <a href="mainCourse.html"
          ><i class="bi bi-egg-fried me-2"></i> <span>Main Course</span></a
        >
      </div>
      <div class="menu-item">
        <a href="drinks.html"
          ><i class="bi bi-cup me-2"></i> <span>Drinks</span></a
        >
      </div>
      <div class="menu-item">
        <a href="order.html"
          ><i class="bi bi-basket me-2"></i> <span>Pesanan</span></a
        >
      </div>
      <div class="menu-item">
        <a href="reservation.html"
          ><i class="bi bi-calendar2-check me-2"></i> <span>Reservasi</span></a
        >
      </div>
      <div class="menu-item">
        <a href="findJobs.html"
          ><i class="bi bi-briefcase me-2"></i> <span>Karir</span></a
        >
      </div>
      <div class="menu-item">
        <a href="report.html"
          ><i class="bi bi-bar-chart-line me-2"></i> <span>Report</span></a
        >
      </div>
      <div class="menu-item">
        <a href="users.html"
          ><i class="bi bi-people me-2"></i> <span>Users</span></a
        >
      </div>
    </div>

    <!-- Main Content Area -->
    <div id="content" class="content">
      <!-- Original Navbar -->
      <nav
        class="navbar navbar-expand-lg navbar-light bg-light shadow-sm rounded mb-4"
      >
        <div class="container-fluid">
          <button id="toggleSidebar" class="btn btn-outline-secondary me-3">
            <i class="bi bi-list"></i>
          </button>
          <a class="navbar-brand" href="#">Main Course</a>
          <div class="dropdown ms-auto">
            <button
              class="profile-button rounded"
              type="button"
              id="profileDropdown"
              data-bs-toggle="dropdown"
            >
              <img
                src="../img/profile-pic.png"
                alt="Profile"
                class="rounded-circle"
                style="width: 40px; height: 40px"
              />
              <div class="text-start">
                <strong>John Doe</strong><br />
                <small class="text-muted">Super Admin</small>
              </div>
            </button>
            <ul class="dropdown-menu dropdown-menu-end profile-dropdown shadow">
              <li>
                <a
                  class="dropdown-item"
                  href="#"
                  data-bs-toggle="modal"
                  data-bs-target="#profileModal"
                >
                  <i class="bi bi-person me-2"></i>Profile
                </a>
              </li>
              <li><hr class="dropdown-divider" /></li>
              <li>
                <a class="dropdown-item text-danger" href="login.html">
                  <i class="bi bi-box-arrow-right me-2"></i>Sign Out
                </a>
              </li>
            </ul>
          </div>
        </div>
      </nav>

      <!-- Main Content -->
      <div class="main-content">
        <div class="table-controls">
          <div class="d-flex gap-3 align-items-center">
            <select class="form-select" style="width: auto" id="entriesPerPage">
              <option value="5">5 entries</option>
              <option value="10">10 entries</option>
              <option value="25">25 entries</option>
              <option value="100">100 entries</option>
            </select>
            <button
              class="btn btn-primary"
              data-bs-toggle="modal"
              data-bs-target="#addMenuModal"
            >
              <i class="bi bi-plus-circle me-2"></i>Add Menu
            </button>
          </div>
          <div class="search-container">
            <input
              type="search"
              class="form-control"
              id="searchInput"
              placeholder="Search menu..."
            />
          </div>
        </div>

        <div class="table-container">
          <table class="table table-hover">
            <thead>
              <tr>
                <th data-sort="id">#</th>
                <th data-sort="image">Image</th>
                <th data-sort="name">Menu Name</th>
                <th data-sort="price">Price</th>
                <th data-sort="ingredients">Main Ingredients</th>
                <th data-sort="category">Category</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="menuTableBody">
              <!-- Data will be populated dynamically -->
            </tbody>
          </table>
        </div>

        <div class="pagination-info">
          <div class="text-muted">
            Showing <span id="startEntry">1</span> to
            <span id="endEntry">5</span> of
            <span id="totalEntries">0</span> entries
          </div>
          <nav aria-label="Table navigation">
            <ul class="pagination mb-0">
              <li class="page-item">
                <button class="page-link" id="prevPage">Previous</button>
              </li>
              <li class="page-item">
                <button class="page-link" id="nextPage">Next</button>
              </li>
            </ul>
          </nav>
        </div>
      </div>
    </div>

    <!-- Add Menu Modal -->
    <div class="modal fade" id="addMenuModal" tabindex="-1">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Add New Menu</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
            ></button>
          </div>
          <div class="modal-body">
            <form id="addMenuForm">
              <div class="mb-3">
                <label class="form-label">Menu Image</label>
                <input
                  type="file"
                  class="form-control"
                  id="menuImage"
                  accept="image/*"
                  required
                />
                <div id="imagePreview"></div>
              </div>
              <div class="mb-3">
                <label class="form-label">Menu Name</label>
                <input
                  type="text"
                  class="form-control"
                  id="menuName"
                  required
                />
              </div>
              <div class="mb-3">
                <label class="form-label">Price (Rp)</label>
                <input
                  type="number"
                  class="form-control"
                  id="menuPrice"
                  required
                  min="0"
                />
              </div>
              <div class="mb-3">
                <label class="form-label">Main Ingredients</label>
                <textarea
                  class="form-control"
                  id="menuIngredients"
                  rows="3"
                  required
                ></textarea>
              </div>
              <div class="mb-3">
                <label class="form-label">Category</label>
                <select class="form-control" id="menuCategory" required>
                  <option value="">Select category</option>
                  <option value="Appetizer">Appetizer</option>
                  <option value="Main Course">Main Course</option>
                  <option value="Dessert">Dessert</option>
                </select>
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              Cancel
            </button>
            <button type="button" class="btn btn-primary" id="saveMenu">
              Save
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Edit Menu Modal -->
    <div class="modal fade" id="editMenuModal" tabindex="-1">
      <div class="modal-dialog modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Edit Menu</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
            ></button>
          </div>
          <div class="modal-body">
            <form id="editMenuForm">
              <input type="hidden" id="editMenuId" />
              <div class="mb-3">
                <label class="form-label">Menu Image</label>
                <input
                  type="file"
                  class="form-control"
                  id="editMenuImage"
                  accept="image/*"
                />
                <div id="editImagePreview"></div>
              </div>
              <div class="mb-3">
                <label class="form-label">Menu Name</label>
                <input
                  type="text"
                  class="form-control"
                  id="editMenuName"
                  required
                />
              </div>
              <div class="mb-3">
                <label class="form-label">Price (Rp)</label>
                <input
                  type="number"
                  class="form-control"
                  id="editMenuPrice"
                  required
                  min="0"
                />
              </div>
              <div class="mb-3">
                <label class="form-label">Main Ingredients</label>
                <textarea
                  class="form-control"
                  id="editMenuIngredients"
                  rows="3"
                  required
                ></textarea>
              </div>
              <div class="mb-3">
                <label class="form-label">Category</label>
                <select class="form-control" id="editMenuCategory" required>
                  <option value="">Select category</option>
                  <option value="Appetizer">Appetizer</option>
                  <option value="Main Course">Main Course</option>
                  <option value="Dessert">Dessert</option>
                </select>
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              Cancel
            </button>
            <button type="button" class="btn btn-primary" id="updateMenu">
              Update
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div class="modal fade" id="deleteMenuModal" tabindex="-1">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Delete Menu</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
            ></button>
          </div>
          <div class="modal-body">
            <p>
              Are you sure you want to delete this menu item? This action cannot
              be undone.
            </p>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              Cancel
            </button>
            <button type="button" class="btn btn-danger" id="confirmDelete">
              Delete
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Required Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      // Sample data for menu items
      let menuData = [
        {
          id: 1,
          image: "../img/menu/nasi-goreng.jpg",
          name: "Nasi Goreng Special",
          price: 25000,
          ingredients: "Rice, Chicken, Vegetables, Egg",
          category: "Main Course",
        },
        {
          id: 2,
          image: "../img/menu/sate-ayam.jpg",
          name: "Sate Ayam",
          price: 35000,
          ingredients: "Chicken, Peanut Sauce, Rice Cake",
          category: "Main Course",
        },
        // Add more sample data as needed
      ];

      // Pagination and table state
      let currentPage = 1;
      let entriesPerPage = 5;
      let currentSort = { column: "id", direction: "asc" };
      let searchTerm = "";

      // DOM Elements
      const entriesSelect = document.getElementById("entriesPerPage");
      const searchInput = document.getElementById("searchInput");
      const prevPageBtn = document.getElementById("prevPage");
      const nextPageBtn = document.getElementById("nextPage");
      const toggleSidebarBtn = document.getElementById("toggleSidebar");

      // Sidebar Toggle
      toggleSidebarBtn.addEventListener("click", () => {
        const sidebar = document.getElementById("sidebar");
        const content = document.getElementById("content");
        sidebar.classList.toggle("collapsed");
        content.classList.toggle("collapsed");
      });

      // Format currency
      const formatCurrency = (amount) => {
        return new Intl.NumberFormat("id-ID", {
          style: "currency",
          currency: "IDR",
        }).format(amount);
      };

      // Filter data based on search term
      const filterData = () => {
        return menuData.filter((item) => {
          const searchStr = searchTerm.toLowerCase();
          return (
            item.name.toLowerCase().includes(searchStr) ||
            item.category.toLowerCase().includes(searchStr) ||
            item.ingredients.toLowerCase().includes(searchStr)
          );
        });
      };

      // Sort data
      const sortData = (data) => {
        return [...data].sort((a, b) => {
          let aVal = a[currentSort.column];
          let bVal = b[currentSort.column];

          if (typeof aVal === "string") {
            aVal = aVal.toLowerCase();
            bVal = bVal.toLowerCase();
          }

          if (currentSort.direction === "asc") {
            return aVal > bVal ? 1 : -1;
          } else {
            return aVal < bVal ? 1 : -1;
          }
        });
      };

      // Render table
      const renderTable = () => {
        const filteredData = filterData();
        const sortedData = sortData(filteredData);
        const tableBody = document.getElementById("menuTableBody");
        tableBody.innerHTML = "";

        const start = (currentPage - 1) * entriesPerPage;
        const end = start + entriesPerPage;
        const paginatedData = sortedData.slice(start, end);

        paginatedData.forEach((item) => {
          const row = document.createElement("tr");
          row.innerHTML = `
              <td>${item.id}</td>
              <td><img src="${item.image}" class="menu-image" alt="${
            item.name
          }"></td>
              <td>${item.name}</td>
              <td>${formatCurrency(item.price)}</td>
              <td>${item.ingredients}</td>
              <td>${item.category}</td>
              <td class="action-buttons">
                <button class="btn btn-sm btn-primary" onclick="editMenu(${
                  item.id
                })">
                  <i class="bi bi-pencil"></i>
                </button>
                <button class="btn btn-sm btn-danger" onclick="deleteMenu(${
                  item.id
                })">
                  <i class="bi bi-trash"></i>
                </button>
              </td>
            `;
          tableBody.appendChild(row);
        });

        // Update pagination info
        document.getElementById("startEntry").textContent = start + 1;
        document.getElementById("endEntry").textContent = Math.min(
          end,
          filteredData.length
        );
        document.getElementById("totalEntries").textContent =
          filteredData.length;

        // Update pagination buttons
        prevPageBtn.disabled = currentPage === 1;
        nextPageBtn.disabled = end >= filteredData.length;
      };

      // Add event listeners
      entriesSelect.addEventListener("change", (e) => {
        entriesPerPage = parseInt(e.target.value);
        currentPage = 1;
        renderTable();
      });

      searchInput.addEventListener("input", (e) => {
        searchTerm = e.target.value;
        currentPage = 1;
        renderTable();
      });

      prevPageBtn.addEventListener("click", () => {
        if (currentPage > 1) {
          currentPage--;
          renderTable();
        }
      });

      nextPageBtn.addEventListener("click", () => {
        const filteredData = filterData();
        if (currentPage * entriesPerPage < filteredData.length) {
          currentPage++;
          renderTable();
        }
      });

      // Sort handlers
      document.querySelectorAll("th[data-sort]").forEach((th) => {
        th.addEventListener("click", () => {
          const column = th.dataset.sort;
          if (currentSort.column === column) {
            currentSort.direction =
              currentSort.direction === "asc" ? "desc" : "asc";
          } else {
            currentSort = { column, direction: "asc" };
          }

          // Update sort indicators
          document.querySelectorAll("th[data-sort]").forEach((el) => {
            el.classList.remove("asc", "desc");
          });
          th.classList.add(currentSort.direction);

          renderTable();
        });
      });

      // Image preview handlers
      document.getElementById("menuImage").addEventListener("change", (e) => {
        const preview = document.getElementById("imagePreview");
        const file = e.target.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = (e) => {
            preview.innerHTML = `<img src="${e.target.result}" alt="Preview">`;
          };
          reader.readAsDataURL(file);
        }
      });

      document
        .getElementById("editMenuImage")
        .addEventListener("change", (e) => {
          const preview = document.getElementById("editImagePreview");
          const file = e.target.files[0];
          if (file) {
            const reader = new FileReader();
            reader.onload = (e) => {
              preview.innerHTML = `<img src="${e.target.result}" alt="Preview">`;
            };
            reader.readAsDataURL(file);
          }
        });

      // CRUD Operations
      const saveMenu = () => {
        const form = document.getElementById("addMenuForm");
        if (!form.checkValidity()) {
          form.reportValidity();
          return;
        }

        const newMenu = {
          id: menuData.length + 1,
          image: URL.createObjectURL(
            document.getElementById("menuImage").files[0]
          ),
          name: document.getElementById("menuName").value,
          price: parseInt(document.getElementById("menuPrice").value),
          ingredients: document.getElementById("menuIngredients").value,
          category: document.getElementById("menuCategory").value,
        };

        menuData.push(newMenu);
        bootstrap.Modal.getInstance(
          document.getElementById("addMenuModal")
        ).hide();
        form.reset();
        document.getElementById("imagePreview").innerHTML = "";
        renderTable();
      };

      const editMenu = (id) => {
        const menu = menuData.find((item) => item.id === id);
        if (menu) {
          document.getElementById("editMenuId").value = menu.id;
          document.getElementById("editMenuName").value = menu.name;
          document.getElementById("editMenuPrice").value = menu.price;
          document.getElementById("editMenuIngredients").value =
            menu.ingredients;
          document.getElementById("editMenuCategory").value = menu.category;
          document.getElementById("editImagePreview").innerHTML = `
              <img src="${menu.image}" alt="Preview">
            `;
          new bootstrap.Modal(document.getElementById("editMenuModal")).show();
        }
      };

      const updateMenu = () => {
        const form = document.getElementById("editMenuForm");
        if (!form.checkValidity()) {
          form.reportValidity();
          return;
        }

        const id = parseInt(document.getElementById("editMenuId").value);
        const index = menuData.findIndex((item) => item.id === id);

        if (index !== -1) {
          const imageFile = document.getElementById("editMenuImage").files[0];
          menuData[index] = {
            ...menuData[index],
            name: document.getElementById("editMenuName").value,
            price: parseInt(document.getElementById("editMenuPrice").value),
            ingredients: document.getElementById("editMenuIngredients").value,
            category: document.getElementById("editMenuCategory").value,
          };

          if (imageFile) {
            menuData[index].image = URL.createObjectURL(imageFile);
          }

          bootstrap.Modal.getInstance(
            document.getElementById("editMenuModal")
          ).hide();
          form.reset();
          document.getElementById("editImagePreview").innerHTML = "";
          renderTable();
        }
      };

      let menuToDelete = null;

      const deleteMenu = (id) => {
        menuToDelete = id;
        new bootstrap.Modal(document.getElementById("deleteMenuModal")).show();
      };

      const confirmDelete = () => {
        if (menuToDelete !== null) {
          menuData = menuData.filter((item) => item.id !== menuToDelete);
          menuToDelete = null;
          bootstrap.Modal.getInstance(
            document.getElementById("deleteMenuModal")
          ).hide();
          renderTable();
        }
      };

      // Initialize event listeners for modal buttons
      document.getElementById("saveMenu").addEventListener("click", saveMenu);
      document
        .getElementById("updateMenu")
        .addEventListener("click", updateMenu);
      document
        .getElementById("confirmDelete")
        .addEventListener("click", confirmDelete);

      // Initial render
      renderTable();
    </script>
  </body>
</html>
